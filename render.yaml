services:
  # PostgreSQL Database Service
  - type: pserv
    name: flat-rental-db
    env: docker
    plan: free
    dockerfilePath: ./Dockerfile.postgres

  # Web Application Service
  - type: web
    name: flat-rental-system
    env: python
    buildCommand: "pip install -r requirements.txt && npm install && npm run build-css-prod && mkdir -p media/profiles media/documents/aadhar media/documents/pan media/documents/other && python manage.py collectstatic --noinput"
    startCommand: "python manage.py migrate && gunicorn flat_rental_system.wsgi:application"
    envVars:
      - key: DEBUG
        value: False
      - key: SECRET_KEY
        generateValue: true
      - key: WEB_CONCURRENCY
        value: 4
      # PostgreSQL Database Connection
      - key: DATABASE_URL
        fromDatabase:
          name: flat-rental-db
          property: connectionString
      # Cloud Storage Settings (Optional - set these if using S3)
      - key: USE_S3
        value: False  # Set to True when you configure S3
      # - key: AWS_ACCESS_KEY_ID
      #   value: your-aws-access-key
      # - key: AWS_SECRET_ACCESS_KEY
      #   value: your-aws-secret-key
      # - key: AWS_STORAGE_BUCKET_NAME
      #   value: your-bucket-name
      # - key: AWS_S3_REGION_NAME
      #   value: us-east-1

databases:
  - name: flat-rental-db
    databaseName: flat_rental_system
    user: flat_rental_user
